<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë„í›ˆì´ ìƒì¼íŒŒí‹° ì´ˆëŒ€ì¥</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --party-red: #D63031;
            --party-gold: #fdcb6e;
            --party-blue: #0984e3;
            --party-purple: #6c5ce7;
            --party-white: #ffffff;
            --bg-dark: #0f0c29;
        }

        body { 
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e); 
            font-family: 'Pretendard', sans-serif;
            display: flex; justify-content: center; align-items: center;
        }

        /* [ì¸íŠ¸ë¡œ ëª¨ì…˜] */
        #envelope-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 100; display: flex; flex-direction: column;
            cursor: pointer; perspective: 1000px;
        }
        .env-part {
            width: 100%; height: 50.5%;
            background: var(--party-red);
            display: flex; justify-content: center; align-items: center;
            transition: transform 1.2s cubic-bezier(0.85, 0, 0.15, 1);
            position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5);
            pointer-events: none;
        }
        .env-top { border-bottom: 3px solid rgba(255,255,255,0.2); align-items: flex-end; transform-origin: top; }
        .env-bottom { border-top: 3px solid rgba(255,255,255,0.2); align-items: flex-start; }
        .env-text { color: white; font-size: 1.8rem; font-weight: bold; padding: 30px; text-align: center; line-height: 1.6; text-shadow: 0 4px 10px rgba(0,0,0,0.3); animation: pulse 1.5s infinite; }
        .blink { animation: blinker 1s linear infinite; font-size: 1.1rem; font-weight: normal; margin-top: 10px; color: #fff; }

        @keyframes blinker { 50% { opacity: 0; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }

        body.open .env-top { transform: translateY(-100%) rotateX(45deg) scaleY(1.1); }
        body.open .env-bottom { transform: translateY(100%) rotateX(-45deg) scaleY(1.1); }
        body.open #envelope-overlay { pointer-events: none; visibility: hidden; transition-delay: 1.2s; }

        /* [ë©”ì¸ ê²Œì„ íŒ¨ë„] */
        #game-stage {
            position: relative; z-index: 10;
            width: 90%; max-width: 450px; min-height: 550px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px; 
            box-shadow: 0 0 30px var(--party-white);
            backdrop-filter: blur(15px);
            display: flex; flex-direction: column; align-items: center;
            padding: 30px; box-sizing: border-box; text-align: center;
            opacity: 0; transform: scale(0.5) rotate(-5deg);
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        body.open #game-stage { opacity: 1; transform: scale(1) rotate(0deg); transition-delay: 0.5s; }

        #quiz-canvas { 
            width: 100%; max-width: 320px; height: 180px; 
            background: #1a1a2e; border-radius: 15px; 
            margin: 15px 0; border: 2px solid var(--party-purple); 
         }

        .scene { display: none; width: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; animation: bounceIn 0.6s ease; }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
         }

        input { 
            width: 85%; padding: 15px; border: 3px solid #dfe6e9; 
            border-radius: 15px; font-size: 1.2rem; margin-bottom: 15px; 
            outline: none; text-align: center; 
          }


        button { 
            width: 90%; padding: 16px; background: linear-gradient(135deg, var(--party-purple), #6c5ce7); 
            color: white; border: none; border-radius: 15px; font-weight: bold; font-size: 1.2rem; 
            cursor: pointer; box-shadow: 0 8px 20px rgba(108, 92, 231, 0.4); margin-bottom: 10px; }
        button:active { transform: scale(0.95); }
        
        /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-back { 
            background: #b2bec3; 
            font-size: 1rem; 
            padding: 10px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            width: 60%; margin-top: 5px; 
           }
        
        .hint-img { width: 100%; max-width: 250px; border-radius: 15px; border: 3px solid var(--party-purple); margin-bottom: 15px; max-height: 250px; object-fit: cover; }
    </style>
</head>
<body>

    <div id="envelope-overlay" onclick="openEnvelope()">
        <div class="env-part env-top">
        <div class="env-text">ğŸ‚<br>ì´ˆëŒ€ì¥ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤</div></div>
        <div class="env-part env-bottom">
        <div class="env-text"><div class="blink">í™”ë©´ì„ í„°ì¹˜í•´ì„œ ì—´ì–´ë³´ì„¸ìš”!</div></div></div>
    </div>


    <div id="game-stage">
        <div id="scene-2" class="scene active">
            <h2 style="color: #4f335c; font-size: 1.8rem;">ğŸ¥³ë„í›ˆì´ ìƒì¼íŒŒí‹°ğŸ¥³</h2>
            <p>ì•ˆë…• ë„í›ˆì•„ í˜¸í˜¸í˜¸<br>ë„ˆì˜ ìƒì¼íŒŒí‹° ì¥ì†ŒëŠ”<br>ë‚´ê°€ ê¼­ê¼­ ìˆ¨ê²¨ë†¨ë‹¨ë‹¤^.^</p>
            <p>ë¬¸ì œë¥¼ ë‹¤ í’€ë©´<br>ì–´ë””ì—ì„œ, ëª‡ì‹œì— ë§Œë‚˜ëŠ”ì§€<br>ì•Œ ìˆ˜ ìˆê² ì§€?ğŸ’¨</p>
            <br>
           <img src="https://i.postimg.cc/j2ZZPvbJ/Kakao-Talk-20260212-000020971.jpg" 
                          width="300" height="400"
                 class="hint-img purple-border" style="background:#fff;" >
                <br>

            <button onclick="nextScene(3)">ë„í›ˆ: ìœ¼íœ´;;(ë¼ê³  í•  ê±° ë‹¤ ì•)</button>
        </div>


        <div id="scene-3" class="scene">
            <h2 style="color: var(--party-red);">ğŸ“ ì¥ì†Œ MISSIONğŸ“</h2>
            <p>ì, ê·¸ëŸ¼ ë¨¼ì €<br><strong>ì¥ì†Œ</strong>ë¶€í„° ë§ì¶°ë³´ìŸˆ! <br> <br>ğŸ˜ì°¸ê³ ë¡œ íŒíŠ¸ëŠ” ì—†ì–´ğŸ˜ </p>
            <br>
          <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fcafefiles.naver.net%2FMjAxOTExMDhfMjkg%2FMDAxNTczMTg2ODI3NDU2.dV6mZnv0-IYYH1vR_YZ6QVsyUhjiBRgef33TovmzT2cg.cvLdnTyBCzQcXInHqyIVxmUkr2j_rvbybGaN2fbWE6cg.JPEG%2FIMG_6544.jpg&type=sc960_832" 
                 class="hint-img purple-border" style="background:#fff;">
               <br>


            <button onclick="nextScene(4)">Let`go!</button>
            <button class="btn-back" onclick="nextScene(2)">ë’¤ë¡œê°€ê¸°</button>
        </div>

        <div id="quiz-area" class="scene">
            <h3 id="stage-title" style="color: var(--party-red);">[ MISSION ]</h3>
            <div id="img-container"></div>
            <canvas id="quiz-canvas"></canvas>
            <input type="text" id="answer-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”!" onkeypress="handleKeyPress(event)">
            <button onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
            <button id="dynamic-back-btn" class="btn-back" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
        </div>

        <div id="scene-8" class="scene">
            <h3 style="color: #27ae60;">ğŸ‰ ì¸„ì¹´ì¸„ì¹´ì¸„! ğŸ‰</h3>
            <p>ë§ˆìŸˆ ì¥ì†ŒëŠ” ë°”ë¡œ ì—¬ê¸°ì•¼!<br>ë¹¨ë¦¬ ì•Œì•„ëƒˆêµ¬ë§Œ!</p>
            <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDAxMTdfMjI1%2FMDAxNzA1NDg5MjUwOTgy.FMPCt-cp-jK2Ly-TjiTVIdLtA0_ToPAN9IOfCOr_lQAg.FvGkqLFIJBzF_kbQVTBJ4QfVyQ-DCzcKjmrYwbvSom0g.JPEG.dasol706%2FIMG_9951.JPG&type=sc960_832" class="hint-img">
            <p>ì, ê·¸ëŸ¼ ë‹¤ìŒì€ <strong>ì‹œê°„</strong>ì„ ë§ì¶°ë³´ì^.^</p>
            <button onclick="nextScene(9)">Let`s go!</button>
            <button class="btn-back" onclick="nextScene(7)">ë’¤ë¡œê°€ê¸°</button>
        </div>

        <div id="scene-10" class="scene">
            <h3 style="color: #6c5ce7;">ğŸ†MISSON COMPLETEğŸ†</h2>
            <br>
            <div style="background: #F7EDE3; padding: 20px; border-radius: 20px; border: 3px dashed #7E6F82; width: 100%; box-sizing: border-box; margin-bottom: 15px;">
                <p style="margin: 0; font-size: 1.1rem; font-weight: bold; line-height:1.6;">
                    ì¥ì†Œì™€ ì‹œê°„ì„ ëª¨ë‘ ë§ì·„ë„¤ ë„í›„ë‹ˆ<br>ë§ì•„ ê·¸ ì¥ì†Œì—ì„œ ê·¸ ì‹œê°„ì— ë³´ë©´ ë¼.<br>ê·¸ëŸ¼ ì´ë”° ë³´ì!<br>
<br> 
<img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDAxMTNfMzAw%2FMDAxNzA1MTQ0MTY1NjIy.QjDgPcdzz1oLLFAP_7mwQNY2kNKZ3O0uYLjIausb2z8g.XF4b9bigVzhtcMrfVpxjoEV9i5bLz51XEkq-UdiLS5kg.JPEG.ottff123%2FIMG_5216.JPG&type=sc960_832"   class="hint-img purple-border" width="300" height="400" >
<br>
                      <br>
                    <span style="font-size: 1.5rem; color: #3B7D23;">ğŸ‚ ìƒì¼ ì¶•í•˜í•´ ë„í›ˆì•„! ğŸ‚</span>
  

                </p>
            </div>
            <button class="btn-back" onclick="nextScene(9)">ë!</button>
        </div>
    </div>

    <script>
         // --- íŒŒí‹° íš¨ê³¼ ë¡œì§ ---
        function startContinuousParty() {
            const duration = 15 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function randomInRange(min, max) { return Math.random() * (max - min) + min; }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);

                const particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }
             
        function openEnvelope() {
            document.body.classList.add('open');
      
          // ì—´ë¦¬ëŠ” ìˆœê°„ í™”ë ¤í•œ íŒ¡íŒŒë ˆ
            const end = Date.now() + (2 * 1000);
            const colors = ['#bb0000', '#ffffff', '#fdcb6e', '#0984e3'];

            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
            
            startContinuousParty();
        }

      
        const quizData = {
            4: { title: "ğŸ§©ë¬¸ì œ 1ğŸ§©", q: "ëŒ€í•œë¯¼êµ­=2, ì¤‘êµ­=3\nëŸ¬ì‹œì•„=4, ë¯¸êµ­=5\nê·¸ë ‡ë‹¤ë©´ ì¼ë³¸ì€?", a: "2" },
            5: { title: "ğŸ—¼ë¬¸ì œ 2ğŸ—¼", q: "ë¬¸ì œ 1ì„ í•œê¸€ë¡œ í•˜ë©´?", a: "ë„ì¿„" },
            6: { title: "ğŸ•µï¸ë¬¸ì œ 3ğŸ•µï¸", q: "ì‚¬ì§„ ì† ì¸ë¬¼ì˜\nì§ì—…ì€ ë¬´ì—‡ì¼ê¹Œìš”?", a: "ì‹œì¥", img: "https://i.namu.wiki/i/CdneRTgAiJnI_SQVhB_CeKvZVAly2hyKCYB4L4sIuTwFMCpNI6B6GOqKTEWD8NWCuADZE10pCEfLngLhzVrHMCqxtvu9_zHMpHdkGF6-gzRYJ_ePMfLox3hubSlXBKlKHBzxfRzhRit9eVRI2QoorQ.webp"  },
            7: { title: "ğŸ»ë¬¸ì œ 4ğŸ»", q: "ë¬¸ì œ 2ë²ˆê³¼ ë¬¸ì œ 3ë²ˆì˜\nì •ë‹µì„ í•©ì¹˜ë©´?", a: "ë„ì¿„ì‹œì¥" },
            9: { title: "â“ë¬¸ì œ 5â“", q: "ë¬¼ìŒí‘œ(?)ì— ë“¤ì–´ê°ˆ\nì •ë‹µì€ ë¬´ì—‡ì¼ê¹Œìš”?", a: "íŒ”",img: "https://i.postimg.cc/90KcmdnX/Kakao-Talk-20260210-010237221.jpg" }
        };

        let currentStep = 2;

        function openEnvelope() {
            document.body.classList.add('open');


             // ì—´ë¦¬ëŠ” ìˆœê°„ í™”ë ¤í•œ íŒ¡íŒŒë ˆ
            const end = Date.now() + (2 * 1000);
            const colors = ['#bb0000', '#ffffff', '#fdcb6e', '#0984e3'];

            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
            
            startContinuousParty();
        }


        function nextScene(step) {
            currentStep = step;
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            
            if (quizData[step]) {
                document.getElementById('quiz-area').classList.add('active');
                loadQuiz(step);
            } else {
                const target = document.getElementById('scene-' + step);
                if(target) target.classList.add('active');
                if (step === 10) startFinalCelebration();
            }
        }

        function goBack() {
            // í€´ì¦ˆ ì˜ì—­ì—ì„œ ë’¤ë¡œê°ˆ ë•Œ
            if (currentStep === 4) nextScene(3);
            else nextScene(currentStep - 1);
        }

        function loadQuiz(step) {
            const data = quizData[step];
            document.getElementById('stage-title').innerText = `[ ${data.title} ]`;
            const imgCont = document.getElementById('img-container');
            imgCont.innerHTML = data.img ? `<img src="${data.img}" class="hint-img">` : "";
            
            const cvs = document.getElementById('quiz-canvas');
            const ctx = cvs.getContext('2d');
            cvs.width = 320; cvs.height = 160;
            ctx.clearRect(0, 0, cvs.width, cvs.height);
            ctx.fillStyle = "#fff"; ctx.font = "bold 18px Pretendard"; ctx.textAlign = "center";
            ctx.font = "bold 20px Pretendard, sans-serif"; 
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";

            
            const lines = data.q.split('\n');
            lines.forEach((line, i) => {
                ctx.fillText(line, cvs.width/2, (cvs.height/2 - (lines.length-1)*15) + (i*30));
            });
            document.getElementById('answer-input').value = "";
            document.getElementById('answer-input').focus();
        }

        function checkAnswer() {
            const val = document.getElementById('answer-input').value.trim().replace(/\s/g, '');
            if (val === quizData[currentStep].a) {
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                nextScene(currentStep + 1);
            } else {
                alert("ë•¡! ë‹¤ì‹œ ìƒê°í•´ë³´ë ´! ğŸ¤ª");
            }
        }

        function handleKeyPress(e) { if (e.key === "Enter") checkAnswer(); }

        function startFinalCelebration() {
            const duration = 15 * 1000;
            const end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff0000', '#ffaa00'] });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#00aaff', '#ff00ff'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }
    </script>
</body>
</html>